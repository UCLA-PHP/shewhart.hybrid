---
title: "p-chart"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{p-chart}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(shewhart.hybrid)
```

```{r}
#===============================================================================
# Use the example percent positive data by age group to test creating a P chart
# In this example we will create charts for age group, rather than location
# Hence some of the variable names will still refer to place settings rather
# than age group
#===============================================================================


#===============================================================================
# Set up all the library connections we need
#===============================================================================

library(httr)
library(DT)
library(tidyverse)
library(broom)
library(readr)
library(lubridate)
library(magrittr)
load_all()

#===============================================================================
# Read in the Percent Positive by age group data
#===============================================================================

Pchart_Data = 
  read_csv("inst/extdata/P Chart Test.csv") %>%
  # Make sure the date is formatted correctly
  mutate(
    date = as.Date(date, "%m/%d/%Y"))

```


```{r}

#===============================================================================
# Calculate place setting as integer values 
# (in this case age group rather than place)  
#===============================================================================

Pchart_Data$stateR = rank(Pchart_Data$place, ties.method = "min")
Pchart_Data$StateRR = match(Pchart_Data$stateR, sort(unique(Pchart_Data$stateR)))

Place_END = max(Pchart_Data$StateRR)


#===============================================================================
# Work through each setting (age group) to calculate the limits 
# based on a P chart
#===============================================================================
OutputData = NULL

k=1
for (k in 1:Place_END) {
  Statei = 
    filter(Pchart_Data, StateRR == k) %>%
    compute_hybrid_p_chart()
    
  
  OutputData %<>% bind_rows(Statei)
  
} #k Setting Loop

```


```{r}

library(plotly)
temp = OutputData %>% dplyr::filter(place == "12-14")
plot_p_chart(data = temp, mode1 = "lines")

```

```{r}

Summ_Tab = summarize_p_chart(OutputData)


```

